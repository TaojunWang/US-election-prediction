raw_data <- labelled::to_factor(raw_data)
reduced_data <- raw_data %>% select(vote_2020, gender, race_ethnicity,education, age)
raw_data2 <- read_dta("inputs/data/usa_00001.dta"
)
raw_data2 <- labelled::to_factor(raw_data2)
reduced_data2 <- raw_data2 %>% select(sex, age, race, educ)
rm(raw_data)
rm(raw_data2)
reduced_data2 <- reduced_data2 %>% filter(as.numeric(age)>17)
reduced_data2 <- reduced_data2 %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data2 <- subset(reduced_data2,select=-age)
reduced_data2$race <- as.character(reduced_data2$race)
reduced_data2[reduced_data2=="black/african american/negro"]<-"black"
reduced_data2[reduced_data2=="other asian or pacific islander"]<-"others"
reduced_data2[reduced_data2=="two major races"]<-"others"
reduced_data2[reduced_data2=="three or more major races"]<-"others"
reduced_data2[reduced_data2=="other race, nec"]<-"others"
reduced_data2[reduced_data2=="american indian or alaska native"]<-"others"
reduced_data2[reduced_data2=="chinese"]<-"others"
reduced_data2[reduced_data2=="japanese"]<-"others"
reduced_data2$sex <- as.character(reduced_data2$sex)
census <-reduced_data2
rm(reduced_data2)
names(census)[names(census)=="sex"]<-"gender"
census <- census %>% mutate(education=ifelse(educ=="n/a or no schooling"|educ=="grade 5, 6, 7, or 8"|educ=="grade 9",yes="secondary/lower",no=ifelse(educ=="grade 10"|educ=="grade 11"|educ=="grade 12",yes="post-secondary",no="college/higher")))
census <- subset(census,select=-educ)
names(reduced_data)[names(reduced_data)=="race_ethnicity"]<-"race"
reduced_data$vote_2020 <-as.character(reduced_data$vote_2020)
reduced_data$gender <-as.character(reduced_data$gender)
reduced_data$race <-as.character(reduced_data$race)
reduced_data$education <-as.character(reduced_data$education)
reduced_data$age <- as.numeric(reduced_data$age)
reduced_data[reduced_data=="Donald Trump"] <-"Trump"
reduced_data[reduced_data=="Joe Biden"] <-"Biden"
reduced_data[reduced_data=="I am not sure/don't know"] <-"Unsure/Unknown"
reduced_data[reduced_data=="I would not vote"] <-"others/not vote"
reduced_data[reduced_data=="Someone else"] <-"others/not vote"
reduced_data <- reduced_data %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data <- subset(reduced_data,select=-age)
reduced_data[reduced_data=="Black, or African American"] <-"black"
reduced_data[reduced_data=="Asian (Japanese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Filipino)"] <-"others"
reduced_data[reduced_data=="Asian (Asian Indian)"] <-"others"
reduced_data[reduced_data=="Asian (Korean)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Native Hawaiian)"] <-"others"
reduced_data[reduced_data=="Some other race"] <-"others"
reduced_data[reduced_data=="American Indian or Alaska Native"] <-"others"
reduced_data[reduced_data=="Asian (Vietnamese)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Guamanian)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Other)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Samoan) "] <-"others"
reduced_data <- reduced_data %>% mutate(educ=ifelse(education=="Middle School - Grades 4 - 8",yes="secondary/lower",no=ifelse(education=="High school graduate",yes="post-secondary",no="college/higher")))
survey <- subset(reduced_data, select=-education)
names(survey)[names(survey)=="educ"]<-"education"
rm(reduced_data)
table(survey$race)
reduced_data[reduced_data=="Pacific Islander (Samoan)"] <-"others"
table(census$race)
library(haven)
library(tidyverse)
library(dplyr)
raw_data <- read_dta("inputs/data/ns20200625.dta")
raw_data <- labelled::to_factor(raw_data)
reduced_data <- raw_data %>% select(vote_2020, gender, race_ethnicity,education, age)
raw_data2 <- read_dta("inputs/data/usa_00001.dta"
)
raw_data2 <- labelled::to_factor(raw_data2)
reduced_data2 <- raw_data2 %>% select(sex, age, race, educ)
rm(raw_data)
rm(raw_data2)
reduced_data2 <- reduced_data2 %>% filter(as.numeric(age)>17)
reduced_data2 <- reduced_data2 %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data2 <- subset(reduced_data2,select=-age)
reduced_data2$race <- as.character(reduced_data2$race)
reduced_data2[reduced_data2=="black/african american/negro"]<-"black"
reduced_data2[reduced_data2=="other asian or pacific islander"]<-"others"
reduced_data2[reduced_data2=="two major races"]<-"others"
reduced_data2[reduced_data2=="three or more major races"]<-"others"
reduced_data2[reduced_data2=="other race, nec"]<-"others"
reduced_data2[reduced_data2=="american indian or alaska native"]<-"others"
reduced_data2[reduced_data2=="chinese"]<-"others"
reduced_data2[reduced_data2=="japanese"]<-"others"
reduced_data2$sex <- as.character(reduced_data2$sex)
census <-reduced_data2
rm(reduced_data2)
names(census)[names(census)=="sex"]<-"gender"
census <- census %>% mutate(education=ifelse(educ=="n/a or no schooling"|educ=="grade 5, 6, 7, or 8"|educ=="grade 9",yes="secondary/lower",no=ifelse(educ=="grade 10"|educ=="grade 11"|educ=="grade 12",yes="post-secondary",no="college/higher")))
census <- subset(census,select=-educ)
names(reduced_data)[names(reduced_data)=="race_ethnicity"]<-"race"
reduced_data$vote_2020 <-as.character(reduced_data$vote_2020)
reduced_data$gender <-as.character(reduced_data$gender)
reduced_data$race <-as.character(reduced_data$race)
reduced_data$education <-as.character(reduced_data$education)
reduced_data$age <- as.numeric(reduced_data$age)
reduced_data[reduced_data=="Donald Trump"] <-"Trump"
reduced_data[reduced_data=="Joe Biden"] <-"Biden"
reduced_data[reduced_data=="I am not sure/don't know"] <-"Unsure/Unknown"
reduced_data[reduced_data=="I would not vote"] <-"others/not vote"
reduced_data[reduced_data=="Someone else"] <-"others/not vote"
reduced_data <- reduced_data %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data <- subset(reduced_data,select=-age)
reduced_data[reduced_data=="Black, or African American"] <-"black"
reduced_data[reduced_data=="Asian (Japanese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Filipino)"] <-"others"
reduced_data[reduced_data=="Asian (Asian Indian)"] <-"others"
reduced_data[reduced_data=="Asian (Korean)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Native Hawaiian)"] <-"others"
reduced_data[reduced_data=="Some other race"] <-"others"
reduced_data[reduced_data=="American Indian or Alaska Native"] <-"others"
reduced_data[reduced_data=="Asian (Vietnamese)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Guamanian)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Other)"] <-"others"
reduced_data[reduced_data=="others Pacific Islander (Samoan)"] <-"others"
reduced_data <- reduced_data %>% mutate(educ=ifelse(education=="Middle School - Grades 4 - 8",yes="secondary/lower",no=ifelse(education=="High school graduate",yes="post-secondary",no="college/higher")))
survey <- subset(reduced_data, select=-education)
names(survey)[names(survey)=="educ"]<-"education"
rm(reduced_data)
table(survey$race)
library(haven)
library(tidyverse)
library(dplyr)
raw_data <- read_dta("inputs/data/ns20200625.dta")
raw_data <- labelled::to_factor(raw_data)
reduced_data <- raw_data %>% select(vote_2020, gender, race_ethnicity,education, age)
raw_data2 <- read_dta("inputs/data/usa_00001.dta"
)
raw_data2 <- labelled::to_factor(raw_data2)
reduced_data2 <- raw_data2 %>% select(sex, age, race, educ)
rm(raw_data)
rm(raw_data2)
reduced_data2 <- reduced_data2 %>% filter(as.numeric(age)>17)
reduced_data2 <- reduced_data2 %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data2 <- subset(reduced_data2,select=-age)
reduced_data2$race <- as.character(reduced_data2$race)
reduced_data2[reduced_data2=="black/african american/negro"]<-"black"
reduced_data2[reduced_data2=="other asian or pacific islander"]<-"others"
reduced_data2[reduced_data2=="two major races"]<-"others"
reduced_data2[reduced_data2=="three or more major races"]<-"others"
reduced_data2[reduced_data2=="other race, nec"]<-"others"
reduced_data2[reduced_data2=="american indian or alaska native"]<-"others"
reduced_data2[reduced_data2=="chinese"]<-"others"
reduced_data2[reduced_data2=="japanese"]<-"others"
reduced_data2$sex <- as.character(reduced_data2$sex)
census <-reduced_data2
rm(reduced_data2)
names(census)[names(census)=="sex"]<-"gender"
census <- census %>% mutate(education=ifelse(educ=="n/a or no schooling"|educ=="grade 5, 6, 7, or 8"|educ=="grade 9",yes="secondary/lower",no=ifelse(educ=="grade 10"|educ=="grade 11"|educ=="grade 12",yes="post-secondary",no="college/higher")))
census <- subset(census,select=-educ)
names(reduced_data)[names(reduced_data)=="race_ethnicity"]<-"race"
reduced_data$vote_2020 <-as.character(reduced_data$vote_2020)
reduced_data$gender <-as.character(reduced_data$gender)
reduced_data$race <-as.character(reduced_data$race)
reduced_data$education <-as.character(reduced_data$education)
reduced_data$age <- as.numeric(reduced_data$age)
reduced_data[reduced_data=="Donald Trump"] <-"Trump"
reduced_data[reduced_data=="Joe Biden"] <-"Biden"
reduced_data[reduced_data=="I am not sure/don't know"] <-"Unsure/Unknown"
reduced_data[reduced_data=="I would not vote"] <-"others/not vote"
reduced_data[reduced_data=="Someone else"] <-"others/not vote"
reduced_data <- reduced_data %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data <- subset(reduced_data,select=-age)
reduced_data[reduced_data=="Black, or African American"] <-"black"
reduced_data[reduced_data=="Asian (Japanese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Filipino)"] <-"others"
reduced_data[reduced_data=="Asian (Asian Indian)"] <-"others"
reduced_data[reduced_data=="Asian (Korean)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Native Hawaiian)"] <-"others"
reduced_data[reduced_data=="Some other race"] <-"others"
reduced_data[reduced_data=="American Indian or Alaska Native"] <-"others"
reduced_data[reduced_data=="Asian (Vietnamese)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Guamanian)"] <-"others"
reduced_data[reduced_data=="others Pacific Islander (Samoan)"] <-"others"
table(reduced_data$race)
reduced_data[reduced_data=="Asian (Other) "] <-"others"
table(reduced_data$race)
reduced_data[reduced_data=="Asian (Other)"] <-"others"
table(reduced_data$race)
reduced_data[reduced_data=="Pacific Islander (Samoan)"] <-"others"
table(reduced_data$race)
reduced_data[reduced_data=="Pacific Islander (Other)"] <-"others"
table(reduced_data$race)
reduced_data[reduced_data=="Pacific Islander (Other)"] <-"others"
table(census$gender)
table(census$age_group)
library(haven)
library(tidyverse)
library(dplyr)
library(broom)
library(here)
library(brms)
library(tidybayes)
raw_data <- read_dta("inputs/data/ns20200625.dta")
raw_data <- labelled::to_factor(raw_data)
reduced_data <- raw_data %>% select(vote_2020, gender, race_ethnicity,education, age)
raw_data2 <- read_dta("inputs/data/usa_00001.dta"
)
raw_data2 <- labelled::to_factor(raw_data2)
reduced_data2 <- raw_data2 %>% select(sex, age, race, educ)
rm(raw_data)
rm(raw_data2)
reduced_data2 <- reduced_data2 %>% filter(as.numeric(age)>17)
reduced_data2 <- reduced_data2 %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data2 <- subset(reduced_data2,select=-age)
reduced_data2$race <- as.character(reduced_data2$race)
reduced_data2[reduced_data2=="black/african american/negro"]<-"black"
reduced_data2[reduced_data2=="other asian or pacific islander"]<-"others"
reduced_data2[reduced_data2=="two major races"]<-"others"
reduced_data2[reduced_data2=="three or more major races"]<-"others"
reduced_data2[reduced_data2=="other race, nec"]<-"others"
reduced_data2[reduced_data2=="american indian or alaska native"]<-"others"
reduced_data2[reduced_data2=="chinese"]<-"others"
reduced_data2[reduced_data2=="japanese"]<-"others"
reduced_data2$sex <- as.character(reduced_data2$sex)
census <-reduced_data2
rm(reduced_data2)
names(census)[names(census)=="sex"]<-"gender"
census <- census %>% mutate(education=ifelse(educ=="n/a or no schooling"|educ=="grade 5, 6, 7, or 8"|educ=="grade 9",yes="secondary/lower",no=ifelse(educ=="grade 10"|educ=="grade 11"|educ=="grade 12",yes="post-secondary",no="college/higher")))
census <- subset(census,select=-educ)
names(reduced_data)[names(reduced_data)=="race_ethnicity"]<-"race"
reduced_data$vote_2020 <-as.character(reduced_data$vote_2020)
reduced_data$gender <-as.character(reduced_data$gender)
reduced_data$race <-as.character(reduced_data$race)
reduced_data$education <-as.character(reduced_data$education)
reduced_data$age <- as.numeric(reduced_data$age)
reduced_data[reduced_data=="Donald Trump"] <-"Trump"
reduced_data[reduced_data=="Joe Biden"] <-"Biden"
reduced_data[reduced_data=="I am not sure/don't know"] <-"Unsure/Unknown"
reduced_data[reduced_data=="I would not vote"] <-"others/not vote"
reduced_data[reduced_data=="Someone else"] <-"others/not vote"
reduced_data <- reduced_data %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data <- subset(reduced_data,select=-age)
reduced_data[reduced_data=="Black, or African American"] <-"black"
reduced_data[reduced_data=="Asian (Japanese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Filipino)"] <-"others"
reduced_data[reduced_data=="Asian (Asian Indian)"] <-"others"
reduced_data[reduced_data=="Asian (Korean)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Native Hawaiian)"] <-"others"
reduced_data[reduced_data=="Some other race"] <-"others"
reduced_data[reduced_data=="American Indian or Alaska Native"] <-"others"
reduced_data[reduced_data=="Asian (Vietnamese)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Guamanian)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Other)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Samoan)"] <-"others"
reduced_data[reduced_data=="Asian (Other)"] <-"others"
reduced_data <- reduced_data %>% mutate(educ=ifelse(education=="Middle School - Grades 4 - 8",yes="secondary/lower",no=ifelse(education=="High school graduate",yes="post-secondary",no="college/higher")))
survey <- subset(reduced_data, select=-education)
names(survey)[names(survey)=="educ"]<-"education"
rm(reduced_data)
table(survey$vote_2020)
survey <- survey %>% filter(vote_2020=="Biden"|vote_2020=="Trump")
model <- brm(vote_2020 ~ (1|age_group) + (1|gender) + (1|race) + (1|education), data = survey, family=bernoulli())
summary(model)
used_data <- sample_n(census,10000)
post_stratified_estimates <- model %>% tidybayes::add_predicted_draws(newdata = used_data,allow_new_levels=TRUE) %>% rename(election_predict = .prediction) %>% summarise(mean = mean(election_predict), lower = quantile(election_predict, 0.025), upper = quantile(election_predict, 0.975))
post_stratified_estimates  %>% ggplot(aes(y = mean, x = forcats::fct_inorder(age_group), color = "MRP estimate")) + geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0) +
ylab("proportion voting Trump") + xlab("age in 2020") +
geom_point(data = survey %>% group_by(age_group, vote_2020) %>%
summarise(n = n()) %>% group_by(age_group) %>% mutate(prop = n/sum(n))
%>% filter(vote_2020=="Trump"), aes(age_group, prop, color = "Survey raw data")) + scale_color_manual(name = "", values = c("MRP estimate" = "black", "Survey raw data" = "red")) + theme_bw(base_size = 10) +
ggtitle("Proportion of voting Trump")
library(haven)
library(tidyverse)
library(dplyr)
library(broom)
library(here)
library(brms)
library(tidybayes)
raw_data <- read_dta("inputs/data/ns20200625.dta")
raw_data <- labelled::to_factor(raw_data)
reduced_data <- raw_data %>% select(vote_2020, gender, race_ethnicity,education, age)
raw_data2 <- read_dta("inputs/data/usa_00001.dta"
)
raw_data2 <- labelled::to_factor(raw_data2)
reduced_data2 <- raw_data2 %>% select(sex, age, race, educ)
rm(raw_data)
rm(raw_data2)
reduced_data2 <- reduced_data2 %>% filter(as.numeric(age)>17)
reduced_data2 <- reduced_data2 %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data2 <- subset(reduced_data2,select=-age)
reduced_data2$race <- as.character(reduced_data2$race)
reduced_data2[reduced_data2=="black/african american/negro"]<-"black"
reduced_data2[reduced_data2=="other asian or pacific islander"]<-"others"
reduced_data2[reduced_data2=="two major races"]<-"others"
reduced_data2[reduced_data2=="three or more major races"]<-"others"
reduced_data2[reduced_data2=="other race, nec"]<-"others"
reduced_data2[reduced_data2=="american indian or alaska native"]<-"others"
reduced_data2[reduced_data2=="chinese"]<-"others"
reduced_data2[reduced_data2=="japanese"]<-"others"
reduced_data2$sex <- as.character(reduced_data2$sex)
census <-reduced_data2
rm(reduced_data2)
names(census)[names(census)=="sex"]<-"gender"
census <- census %>% mutate(education=ifelse(educ=="n/a or no schooling"|educ=="grade 5, 6, 7, or 8"|educ=="grade 9",yes="secondary/lower",no=ifelse(educ=="grade 10"|educ=="grade 11"|educ=="grade 12",yes="post-secondary",no="college/higher")))
census <- subset(census,select=-educ)
help(pie)
pie(census$gender)
census %>% ggplot(aes(x=age_group))
knitr::opts_chunk$set(echo = FALSE)
library(haven)
library(tidyverse)
library(dplyr)
library(broom)
library(here)
library(brms)
library(tidybayes)
library(plyr)
library(scales)
model <- brm(vote_Trump_or_not ~ (1|age_group) + (1|gender) + (1|race) + (1|education), data = survey, family=bernoulli(link = "logit"))
model <- brm(vote_Trump_or_not ~ (1|age_group) + (1|gender) + (1|race) + (1|education), data = survey, family=bernoulli(link = "logit"))
knitr::opts_chunk$set(echo = FALSE)
library(haven)
library(tidyverse)
library(dplyr)
library(broom)
library(here)
library(brms)
library(tidybayes)
library(plyr)
library(scales)
setwd('C:/Users/wangt/Desktop/sta304/ps4/draft/forecasting')
raw_data <- read_dta("inputs/data/ns20200625.dta")
raw_data <- labelled::to_factor(raw_data)
reduced_data <- raw_data %>% select(vote_2020, gender, race_ethnicity,education, age)
raw_data2 <- read_dta("inputs/data/usa_00001.dta"
)
raw_data2 <- labelled::to_factor(raw_data2)
reduced_data2 <- raw_data2 %>% select(sex, age, race, educ)
varcount1 <-count(raw_data$vote_2016)
ggplot(varcount1,aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("2016 election")
varcount2 <-count(raw_data$vote_2020)
ggplot(varcount2, aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("2020 election survey")
raw_data %>% ggplot(aes(x=age))+geom_histogram(bins = 100, colour = "black", fill = "grey")+ labs(title = "Age of participants in the survey")
table(raw_data$race_ethnicity)
table(raw_data$education)
raw_data %>% ggplot(aes(x=gender))+geom_bar()+labs(title = "Gender of participants in the survey")
rm(raw_data)
rm(raw_data2)
reduced_data2 <- reduced_data2 %>% filter(as.numeric(age)>17)
reduced_data2 <- reduced_data2 %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data2 <- subset(reduced_data2,select=-age)
reduced_data2$race <- as.character(reduced_data2$race)
reduced_data2[reduced_data2=="black/african american/negro"]<-"black"
reduced_data2[reduced_data2=="other asian or pacific islander"]<-"others"
reduced_data2[reduced_data2=="two major races"]<-"others"
reduced_data2[reduced_data2=="three or more major races"]<-"others"
reduced_data2[reduced_data2=="other race, nec"]<-"others"
reduced_data2[reduced_data2=="american indian or alaska native"]<-"others"
reduced_data2[reduced_data2=="chinese"]<-"others"
reduced_data2[reduced_data2=="japanese"]<-"others"
reduced_data2$sex <- as.character(reduced_data2$sex)
census <-reduced_data2
rm(reduced_data2)
names(census)[names(census)=="sex"]<-"gender"
census <- census %>% mutate(education=ifelse(educ=="n/a or no schooling"|educ=="grade 5, 6, 7, or 8"|educ=="grade 9",yes="secondary/lower",no=ifelse(educ=="grade 10"|educ=="grade 11"|educ=="grade 12",yes="post-secondary",no="college/higher")))
census <- subset(census,select=-educ)
names(reduced_data)[names(reduced_data)=="race_ethnicity"]<-"race"
reduced_data$vote_2020 <-as.character(reduced_data$vote_2020)
reduced_data$gender <-as.character(reduced_data$gender)
reduced_data$race <-as.character(reduced_data$race)
reduced_data$education <-as.character(reduced_data$education)
reduced_data$age <- as.numeric(reduced_data$age)
reduced_data[reduced_data=="Donald Trump"] <-"Trump"
reduced_data[reduced_data=="Joe Biden"] <-"Biden"
reduced_data[reduced_data=="I am not sure/don't know"] <-"Unsure/Unknown"
reduced_data[reduced_data=="I would not vote"] <-"others/not vote"
reduced_data[reduced_data=="Someone else"] <-"others/not vote"
reduced_data <- reduced_data %>% mutate(age_group=ifelse(as.numeric(age)<35,yes = "18to34",no=ifelse(as.numeric(age)<51,yes="35to50",no=ifelse(as.numeric(age)<66,yes="51to65",no="66to97"))))
reduced_data <- subset(reduced_data,select=-age)
reduced_data[reduced_data=="Black, or African American"] <-"black"
reduced_data[reduced_data=="Asian (Japanese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Chinese)"] <-"others"
reduced_data[reduced_data=="Asian (Filipino)"] <-"others"
reduced_data[reduced_data=="Asian (Asian Indian)"] <-"others"
reduced_data[reduced_data=="Asian (Korean)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Native Hawaiian)"] <-"others"
reduced_data[reduced_data=="Some other race"] <-"others"
reduced_data[reduced_data=="American Indian or Alaska Native"] <-"others"
reduced_data[reduced_data=="Asian (Vietnamese)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Guamanian)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Other)"] <-"others"
reduced_data[reduced_data=="Pacific Islander (Samoan)"] <-"others"
reduced_data[reduced_data=="Asian (Other)"] <-"others"
reduced_data <- reduced_data %>% mutate(educ=ifelse(education=="Middle School - Grades 4 - 8",yes="secondary/lower",no=ifelse(education=="High school graduate",yes="post-secondary",no="college/higher")))
survey <- subset(reduced_data, select=-education)
names(survey)[names(survey)=="educ"]<-"education"
rm(reduced_data)
varcount3 <-count(survey$age_group)
ggplot(varcount3,aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("Paricipants' Age")
varcount4 <-count(survey$race)
ggplot(varcount4,aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("Paricipants' Race")
varcount5 <-count(survey$education)
ggplot(varcount5,aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("Paricipants' Education Level")
varcount6 <-count(census$age_group)
ggplot(varcount6,aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("Population Age Group")
varcount7 <-count(survey$race)
ggplot(varcount7,aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("Population Race Ethnicity")
varcount8 <-count(census$education)
ggplot(varcount8,aes(x="",y=freq,fill=x))+geom_bar(stat = "identity")+coord_polar(theta = "y")+ggtitle("Population Education Level")
survey <- survey %>% filter(vote_2020=="Biden"|vote_2020=="Trump")
survey <- survey %>% mutate(vote_Trump_or_not=ifelse(vote_2020=="Trump",yes=1,no=0))
survey <- subset(survey, select=-vote_2020)
model <- brm(vote_Trump_or_not ~ (1|age_group) + (1|gender) + (1|race) + (1|education), data = survey, family=bernoulli(link = "logit"))
knitr::opts_chunk$set(echo = FALSE)
library(haven)
library(tidyverse)
library(dplyr)
library(broom)
library(here)
library(plyr)
library(scales)
model <- glm(vote_Trump_or_not ~ age_group + education + gender + race, data = survey, family = "binomial")
survey$
summary(model)
summary(model)
pred_probs <- predict(object = model, newdata = census, type = "prob")
pred_probs <- predict(object = model, newdata = census, type = "prob")
pred_probs <- predict(model, census)
pred_probs <- predict(model, census,allow_new_levels=TRUE)
summary(model)
survey[survey=="secondary/lower"] <- "high_school/lower"
survey$education
survey[survey=="post-secondary"] <- "post-secondary"
census[census=="secondary/lower"] <- "high_school/lower"
census[census=="post-secondary"] <- "post-secondary"
survey$education
survey[survey=="secondary/lower"] <- "high_school/lower"
survey[survey=="post-secondary"] <- "high_school/lower"
census[census=="secondary/lower"] <- "high_school/lower"
census[census=="post-secondary"] <- "high_school/lower"
survey$education
model <- glm(vote_Trump_or_not ~ age_group + education + gender + race, data = survey, family = "binomial")
summary(model)
x <- predict(model, census,allow_new_levels=TRUE)
x <- predict(model, census)
summary(model)
x <- predict(model, census)
census$gender
glimpe(cenus)
glimpse(census)
glimpse(survey)
survey$gender
census[census=="white"] <-"White"
census[census=="female"] <-"Female"
census[census=="male"] <-"Male"
glimpse(census)
x <- predict(model, census)
rm(x)
prediction <- predict(model, census, type="prob")
prediction <- predict(model, census, type="response")
summary(prediction)
data.frame(prediction)
tibble(prediction)
prediction <- tibble(prediction)
sumamry(prediction)
summary(prediction)
prediction %>% ggplot(aes(x=""))+geom_boxplot
prediction %>% ggplot(aes())+geom_boxplot
ID <- c(1:497338)
predict <- tibble(prediction)
prediction <- c(ID, prediction)
glimspe(prediction)
predict <- predict(model, census, type="response")
prediction <- c(ID, predict)
prediction <- data.frame(ID, predict)
prediction <- tibble(ID, predict)
prob <- predict(model, census, type="response")
summary(prediction)
prediction <- tibble(ID, prob)
prob <- predict(model, census, type="response")
summary(prob)
ID <- c(1:497338)
prediction <- tibble(ID, prob)
prediction %>% ggplot(aes(x="",y=prob))+geom_boxplot()
prediction %>% ggplot(aes(x="",y=prob))+geom_boxplot()+ggtitle("The Probabilty of voting for Trump")
knitr::opts_chunk$set(echo = FALSE)
library(haven)
library(tidyverse)
library(dplyr)
library(broom)
library(here)
library(plyr)
library(scales)
n <- nrow(survey)
set.seed(3461)
training_indices <- sample(1:n, size=round(0.8*n))
train <- data[training_indices,]
train <- survey[training_indices,]
test <- data[-training_indices,]
test <- survey[-training_indices,]
train_model <- glm(vote_Trump_or_not ~ age_group + education + gender + race, data = train, family = "binomial")
test_predictions <- predict(train_model,test,type="response")
table(test_predictions,test$vote_Trump_or_not)
test_predictions
id <-c(1:1040)
test_predict<- predict(train_model,test,type="response")
test_predictions <- tibble(id, test_predict)
test_predict<- predict(train_model,test,type="response")
summary(test_predict)
summary(test$vote_Trump_or_not)
mean(test$vote_Trump_or_not)
summary(test_predict)
mean(test$vote_Trump_or_not)
